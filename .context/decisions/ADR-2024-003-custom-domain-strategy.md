# Decision Record: Custom Domain Strategy for All Environments

**Decision ID**: ADR-2024-003  
**Date**: October 6, 2025  
**Author(s)**: Project Lead  
**Status**: Accepted

## Context
DapFlow had three environments (production, staging, development) but only production had a custom domain. The other environments used Vercel's auto-generated URLs, which were:
- Difficult to remember and share
- Not professional for client demonstrations
- Confusing for team collaboration
- Required authentication by default (Vercel preview protection)

## Decision
Implement custom subdomain strategy for all environments:
- **Production**: `dapflow.com` (main branch)
- **Staging**: `stage.dapflow.com` (staging branch)
- **Development**: `dev.dapflow.com` (develop branch)
- **Feature Previews**: Auto-generated Vercel URLs (feature branches)

## Rationale

### Benefits of Custom Domains
1. **Professional Appearance**: Custom domains for client and stakeholder demonstrations
2. **Easy to Remember**: Simple, memorable URLs for team access
3. **Consistent Branding**: All environments use dapflow.com domain
4. **No Authentication Issues**: Custom domains bypass Vercel preview protection
5. **Better Testing**: Easier to test cross-domain features and cookies

### Domain Naming Strategy
- **`dapflow.com`**: Primary production site
- **`stage.dapflow.com`**: Clear indication of staging environment
- **`dev.dapflow.com`**: Clear indication of development environment

### Alternative Naming Considered
- **`staging.dapflow.com`**: Too long, "stage" is more concise
- **`preview.dapflow.com`**: Confusing with feature previews
- **`test.dapflow.com`**: Less clear than "dev" for development

## Alternatives Considered

### Alternative 1: Keep Vercel Auto-generated URLs
- **Pros**: No DNS configuration needed, zero cost
- **Cons**: Long, difficult URLs; authentication issues; unprofessional
- **Rejected**: Poor user experience for team and clients

### Alternative 2: Custom Domains Only for Production and Staging
- **Pros**: Fewer DNS records to manage
- **Cons**: Development environment still has authentication issues
- **Rejected**: Development environment is heavily used by team

### Alternative 3: Separate Root Domains
- **Pros**: Complete separation between environments
- **Cons**: Additional costs, branding confusion, DNS complexity
- **Rejected**: Unnecessary complexity and cost

## Consequences

### Positive
- Professional URLs for all environments
- No authentication barriers for team access
- Easy to share with clients and stakeholders
- Consistent branding across all environments
- Better developer experience
- Easier to remember and communicate

### Negative
- Additional DNS configuration required
- More DNS records to manage
- Potential for DNS propagation delays during setup
- Need to update documentation with new URLs

### Neutral
- No additional cost (Vercel includes custom domains)
- Minimal ongoing maintenance once configured

## Implementation

### DNS Configuration
```
Type: CNAME
Name: stage
Value: cname.vercel-dns.com

Type: CNAME
Name: dev
Value: cname.vercel-dns.com
```

### Vercel Configuration
1. Added `stage.dapflow.com` assigned to `staging` branch (Preview environment)
2. Added `dev.dapflow.com` assigned to `develop` branch (Preview environment)
3. Disabled preview protection for both staging and development environments
4. Verified DNS propagation and SSL certificate generation

### Documentation Updates
- Updated `.context/current_state.md` with new URLs
- Updated `.context/quick_reference.md` with environment table
- Updated team workflow documentation
- Communicated changes to team members

## Monitoring

### Success Metrics
- [ ] All custom domains resolve correctly
- [x] SSL certificates generated and valid
- [x] No authentication barriers on custom domains
- [ ] Team adoption of new URLs
- [ ] Reduced confusion about environment access

### Health Checks
- Monitor DNS resolution for all custom domains
- Verify SSL certificate renewal
- Track team usage of custom vs auto-generated URLs
- Monitor for any DNS-related issues

## Related
- **Tasks**: Environment setup and domain configuration tasks
- **Sessions**: SES-2024-002 (Domain setup session)
- **PRs**: Environment configuration updates

## Notes

### DNS Propagation
- Initial DNS propagation took approximately 10 minutes
- All custom domains now resolve correctly
- SSL certificates automatically generated by Vercel

### Preview Protection
- Disabled preview protection for staging and development
- Feature branches still use auto-generated URLs with protection
- Team members can access all environments without authentication

### Future Considerations
- Consider adding `api.dapflow.com` if API-specific features needed
- May add `docs.dapflow.com` for documentation site
- Could add `admin.dapflow.com` for administrative interfaces

This decision significantly improves the developer experience and professional appearance of the DapFlow project across all environments.
